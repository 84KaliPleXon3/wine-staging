From 5572b69c353046c100291290c4864c87bd4eea12 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Fri, 24 May 2019 08:21:52 +1000
Subject: [PATCH] Revert "xaudio2: Use new features from FAudio 19.06 (but keep
 compatibility for <=19.05)."

This reverts commit d341efeff071532801fdc224062eb9e60dc5aea0.
---
 configure                   | 17 -----------------
 configure.ac                |  4 ----
 dlls/xaudio2_7/x3daudio.c   |  6 ------
 dlls/xaudio2_7/xaudio_dll.c |  6 +-----
 include/config.h.in         |  6 ------
 5 files changed, 1 insertion(+), 38 deletions(-)

diff --git a/configure b/configure
index 2ad2639..c206e8d 100755
--- a/configure
+++ b/configure
@@ -14966,23 +14966,6 @@ CPPFLAGS=$ac_save_CPPFLAGS
 test -z "$FAUDIO_CFLAGS" || FAUDIO_CFLAGS=`echo " $FAUDIO_CFLAGS" | sed 's/ -I\([^/]\)/ -I\$(top_builddir)\/\1/g'`
 test -z "$FAUDIO_LIBS" || FAUDIO_LIBS=`echo " $FAUDIO_LIBS" | sed 's/ -L\([^/]\)/ -L\$(top_builddir)\/\1/g'`
 
-    ac_wine_check_funcs_save_LIBS="$LIBS"
-LIBS="$LIBS $FAUDIO_LIBS"
-for ac_func in \
-        FAudio_CommitOperationSet \
-        F3DAudioInitialize8
-do :
-  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
-
-fi
-done
-
-LIBS="$ac_wine_check_funcs_save_LIBS"
 fi
 if test "x$ac_cv_lib_soname_FAudio" = "x"; then :
   case "x$with_faudio" in
diff --git a/configure.ac b/configure.ac
index f548e3e..83a8181 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1690,10 +1690,6 @@ then
     WINE_PACKAGE_FLAGS(FAUDIO,[faudio],[-lFAudio],,,
         [AC_CHECK_HEADERS([FAudio.h],
             [WINE_CHECK_SONAME(FAudio,FAudioCreate,,,[$FAUDIO_LIBS],[[libFAudio*]])])])
-    WINE_CHECK_LIB_FUNCS(\
-        FAudio_CommitOperationSet \
-        F3DAudioInitialize8,
-        [$FAUDIO_LIBS])
 fi
 WINE_NOTICE_WITH(faudio,[test "x$ac_cv_lib_soname_FAudio" = "x"],
                  [libFAudio ${notice_platform}development files not found, XAudio2 won't be supported.])
diff --git a/dlls/xaudio2_7/x3daudio.c b/dlls/xaudio2_7/x3daudio.c
index 5bc7c84..ee3367e 100644
--- a/dlls/xaudio2_7/x3daudio.c
+++ b/dlls/xaudio2_7/x3daudio.c
@@ -17,8 +17,6 @@
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
  */
 
-#include "config.h"
-
 #include <stdarg.h>
 
 #include "windef.h"
@@ -53,12 +51,8 @@ HRESULT CDECL X3DAudioInitialize(UINT32 chanmask, float speedofsound,
         X3DAUDIO_HANDLE handle)
 {
     TRACE("0x%x, %f, %p\n", chanmask, speedofsound, handle);
-#ifdef HAVE_F3DAUDIOINITIALIZE8
-    return F3DAudioInitialize8(chanmask, speedofsound, handle);
-#else
     F3DAudioInitialize(chanmask, speedofsound, handle);
     return S_OK;
-#endif
 }
 #endif /* XAUDIO2_VER >= 8 */
 
diff --git a/dlls/xaudio2_7/xaudio_dll.c b/dlls/xaudio2_7/xaudio_dll.c
index f135642..70ba243 100644
--- a/dlls/xaudio2_7/xaudio_dll.c
+++ b/dlls/xaudio2_7/xaudio_dll.c
@@ -1797,13 +1797,9 @@ static HRESULT WINAPI IXAudio2Impl_CommitChanges(IXAudio2 *iface,
 {
     IXAudio2Impl *This = impl_from_IXAudio2(iface);
 
-    TRACE("(%p)->(0x%x)\n", This, operationSet);
+    TRACE("(%p)->(0x%x): stub!\n", This, operationSet);
 
-#ifdef HAVE_FAUDIO_COMMITOPERATIONSET
-    return FAudio_CommitOperationSet(This->faudio, operationSet);
-#else
     return FAudio_CommitChanges(This->faudio);
-#endif
 }
 
 static void WINAPI IXAudio2Impl_GetPerformanceData(IXAudio2 *iface,
diff --git a/include/config.h.in b/include/config.h.in
index ce5c157..774e9ee 100644
--- a/include/config.h.in
+++ b/include/config.h.in
@@ -146,15 +146,9 @@
 /* Define to 1 if you have the `expm1f' function. */
 #undef HAVE_EXPM1F
 
-/* Define to 1 if you have the `F3DAudioInitialize8' function. */
-#undef HAVE_F3DAUDIOINITIALIZE8
-
 /* Define to 1 if you have the `fallocate' function. */
 #undef HAVE_FALLOCATE
 
-/* Define to 1 if you have the `FAudio_CommitOperationSet' function. */
-#undef HAVE_FAUDIO_COMMITOPERATIONSET
-
 /* Define to 1 if you have the <FAudio.h> header file. */
 #undef HAVE_FAUDIO_H
 
-- 
1.9.1

