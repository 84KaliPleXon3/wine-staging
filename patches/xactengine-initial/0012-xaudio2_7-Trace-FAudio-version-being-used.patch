From b331a9b8e5a7eb893fa9a8e04244646910354430 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Tue, 14 Jan 2020 15:47:15 +1100
Subject: [PATCH] xaudio2_7: Trace FAudio version being used

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 configure.ac                | 3 ++-
 dlls/xaudio2_7/xaudio_dll.c | 3 +++
 include/config.h.in         | 3 +++
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/configure.ac b/configure.ac
index 47d2b750c0..f688b56967 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1738,7 +1738,8 @@ then
         [AC_CHECK_HEADERS([FAudio.h],
             [WINE_CHECK_SONAME(FAudio,FAudioCreate,,,[$FAUDIO_LIBS],[[libFAudio*]])])
              WINE_CHECK_LIB_FUNCS([FAudio_CommitOperationSet \
-                                   F3DAudioInitialize8], [$FAUDIO_LIBS])
+                                   F3DAudioInitialize8 \ 
+                                   FAudioLinkedVersion], [$FAUDIO_LIBS])
             ])
 fi
 WINE_NOTICE_WITH(faudio,[test "x$ac_cv_lib_soname_FAudio" = "x"],
diff --git a/dlls/xaudio2_7/xaudio_dll.c b/dlls/xaudio2_7/xaudio_dll.c
index a87e0124d3..2601a280ba 100644
--- a/dlls/xaudio2_7/xaudio_dll.c
+++ b/dlls/xaudio2_7/xaudio_dll.c
@@ -90,6 +90,9 @@ BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD reason, void *pReserved)
     case DLL_PROCESS_ATTACH:
         instance = hinstDLL;
         DisableThreadLibraryCalls( hinstDLL );
+#ifdef HAVE_FAUDIOLINKEDVERSION
+        TRACE("Using FAudio version %d\n", FAudioLinkedVersion() );
+#endif
         break;
     }
     return TRUE;
diff --git a/include/config.h.in b/include/config.h.in
index 1d0b216b6a..887ed3026b 100644
--- a/include/config.h.in
+++ b/include/config.h.in
@@ -152,6 +152,9 @@
 /* Define to 1 if you have the `fallocate' function. */
 #undef HAVE_FALLOCATE
 
+/* Define to 1 if you have the `FAudioLinkedVersion' function. */
+#undef HAVE_FAUDIOLINKEDVERSION
+
 /* Define to 1 if you have the `FAudio_CommitOperationSet' function. */
 #undef HAVE_FAUDIO_COMMITOPERATIONSET
 
-- 
2.17.1

