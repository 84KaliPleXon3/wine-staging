From 04c452501e9c4e25d2ad2abf704bb30be5674719 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Wed, 26 Jun 2019 10:38:23 +1000
Subject: [PATCH] uxtheme: Dont build with msvcrt

---
 dlls/uxtheme/Makefile.in |  2 --
 dlls/uxtheme/msstyles.c  | 17 ++++++++---------
 2 files changed, 8 insertions(+), 11 deletions(-)

diff --git a/dlls/uxtheme/Makefile.in b/dlls/uxtheme/Makefile.in
index d0409300230..e09f891ee48 100644
--- a/dlls/uxtheme/Makefile.in
+++ b/dlls/uxtheme/Makefile.in
@@ -4,8 +4,6 @@ IMPORTS   = user32 gdi32 advapi32
 DELAYIMPORTS = msimg32
 EXTRAINCL = $(GTK3_CFLAGS)
 
-EXTRADLLFLAGS = -mno-cygwin
-
 C_SRCS = \
 	buffer.c \
 	draw.c \
diff --git a/dlls/uxtheme/msstyles.c b/dlls/uxtheme/msstyles.c
index 5030e52a597..bc898f13453 100644
--- a/dlls/uxtheme/msstyles.c
+++ b/dlls/uxtheme/msstyles.c
@@ -17,7 +17,6 @@
  * License along with this library; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
  */
-
 #include <stdarg.h>
 #include <stdlib.h>
 
@@ -31,7 +30,7 @@
 #include "tmschema.h"
 
 #include "msstyles.h"
-
+#include "wine/unicode.h"
 #include "wine/exception.h"
 #include "wine/debug.h"
 #include "wine/heap.h"
@@ -353,7 +352,7 @@ static BOOL MSSTYLES_ParseIniSectionName(LPCWSTR lpSection, DWORD dwLen, LPWSTR
     *iStateId = 0;
     comp = sec;
     /* Get the application name */
-    tmp = wcschr(comp, ':');
+    tmp = strchrW(comp, ':');
     if(tmp) {
         *tmp++ = 0;
         tmp++;
@@ -361,19 +360,19 @@ static BOOL MSSTYLES_ParseIniSectionName(LPCWSTR lpSection, DWORD dwLen, LPWSTR
         comp = tmp;
     }
 
-    tmp = wcschr(comp, '.');
+    tmp = strchrW(comp, '.');
     if(tmp) {
         *tmp++ = 0;
         lstrcpynW(szClassName, comp, MAX_THEME_CLASS_NAME);
         comp = tmp;
         /* now get the part & state */
-        tmp = wcschr(comp, '(');
+        tmp = strchrW(comp, '(');
         if(tmp) {
             *tmp++ = 0;
             lstrcpynW(part, comp, ARRAY_SIZE(part));
             comp = tmp;
             /* now get the state */
-            tmp = wcschr(comp, ')');
+            tmp = strchrW(comp, ')');
             if (!tmp)
                 return FALSE;
             *tmp = 0;
@@ -384,13 +383,13 @@ static BOOL MSSTYLES_ParseIniSectionName(LPCWSTR lpSection, DWORD dwLen, LPWSTR
         }
     }
     else {
-        tmp = wcschr(comp, '(');
+        tmp = strchrW(comp, '(');
         if(tmp) {
             *tmp++ = 0;
             lstrcpynW(szClassName, comp, MAX_THEME_CLASS_NAME);
             comp = tmp;
             /* now get the state */
-            tmp = wcschr(comp, ')');
+            tmp = strchrW(comp, ')');
             if (!tmp)
                 return FALSE;
             *tmp = 0;
@@ -1014,7 +1013,7 @@ PTHEME_CLASS MSSTYLES_OpenThemeClass(LPCWSTR pszAppName, LPCWSTR pszClassList)
     }
 
     start = pszClassList;
-    while((end = wcschr(start, ';'))) {
+    while((end = strchrW(start, ';'))) {
         len = end-start;
         lstrcpynW(szClassName, start, min(len+1, ARRAY_SIZE(szClassName)));
         start = end+1;
-- 
2.17.1

